<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <iframe src="https://extremelystiff.github.io/sandstormplayercount/widget.html" frameborder="0" scrolling="no" width="100%" height="auto"></iframe>
    <title>Insurgency Sandstorm Server Setup</title>
    <meta property="og:title" content="Insurgency: Sandstorm Server Launcher">
    <meta property="og:description" content="A powerful and user-friendly web application that allows you to effortlessly launch and configure your own Insurgency: Sandstorm dedicated server right from your browser.">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 1px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .quick-start {
            text-align: center;
            margin-bottom: 30px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 5px;
            font-weight: 500;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn-large {
            font-size: 1.2em;
            padding: 15px 25px;
        }

        .btn:hover {
            opacity: 0.9;
        }

        #serverForm {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        #serverForm label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        #serverForm input,
        #serverForm select {
            width: 95%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-actions {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .config-output {
            margin-top: 30px;
            width: 100%;
        }

        #configOutput {
            width: 100%;
            height: 200px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }

        #presetsContainer {
            margin-top: 30px;
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
        }

        #presetButtons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .preset {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #fff;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .preset-actions {
            display: flex;
            gap: 10px;
        }

        h1, h2 {
            color: #2c3e50;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: bold;
            color: #777;
            transition: color 0.3s;
        }

        .tab.active {
            color: #3498db;
            border-bottom: 2px solid #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .mutator-section {
            margin-top: 20px;
        }

        .mod-section {
            margin-top: 20px;
        }

        details {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }

        summary {
            font-weight: bold;
            cursor: pointer;
            padding: 5px;
        }

        #mutatorCheckboxes, #modCheckboxes {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .checkbox-item:hover {
            background-color: #f9f9f9;
        }

        .checkbox-item label {
            margin-left: 10px;
            flex: 1;
        }

        .item-description {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
            margin-left: 25px;
        }

        #selectedModsOutput, #selectedMutatorsOutput {
            margin-top: 10px;
            width: 100%;
            min-height: 100px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
        }

        .info-box {
            background-color: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .search-box {
            display: flex;
            margin-bottom: 10px;
        }

        .search-box input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
        }

        .search-box button {
            border-radius: 0 4px 4px 0;
            padding: 8px 12px;
        }

        abbr {
            text-decoration: none;
            border-bottom: 1px dotted #666;
            cursor: help;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Insurgency Sandstorm Server Setup</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'serverConfig')">Server Configuration</button>
            <button class="tab" onclick="openTab(event, 'mods')">Mods</button>
            <button class="tab" onclick="openTab(event, 'mutators')">Mutators</button>
        </div>
        
        <div class="main-content">
            <div id="serverConfig" class="tab-content active">
                <div class="quick-start">
                    <button id="quickStartButton" class="btn btn-primary btn-large" onclick="quickStart()">Quick Launch Random Map Server</button>
                </div>
                
                <h2>Server Configuration</h2>
                <form id="serverForm">
                    <div class="form-group">
                        <label for="os">Operating System:</label>
                        <select name="os" id="os">
                            <option value="windows">Windows</option>
                            <option value="linux">Linux</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="hostname">Server Name:</label>
                        <input type="text" id="hostname" name="hostname" placeholder="Enter server name">
                    </div>
                    
                    <div class="form-group">
                        <label for="maxPlayers">Max Players:</label>
                        <input type="number" id="maxPlayers" name="maxPlayers" placeholder="24" min="1" max="99" value="24">
                    </div>
                    
                    <div class="form-group">
                        <label for="port">
                            Game Port
                            <abbr title="For your server to show up on the server browser, you will have to forward both TCP and UDP. You can find tutorials on port forwarding on a lot of websites. We suggest portforward.com, which offers tutorials for most router manufacturers.">?</abbr>:
                        </label>
                        <input type="number" id="port" name="port" placeholder="27102" min="1" max="65535" value="27102">
                    </div>
                    
                    <div class="form-group">
                        <label for="queryPort">
                            Query Port
                            <abbr title="The query port is used by the server browser to retrieve information about your server. It should be a different port than the game port.">?</abbr>:
                        </label>
                        <input type="number" id="queryPort" name="queryPort" placeholder="27131" min="1" max="65535" value="27131">
                    </div>
                    
                    <div class="form-group">
                        <label for="scenario">Choose a Scenario:</label>
                        <select name="scenario" id="scenario">
                            <option value="Bab?Scenario=Scenario_Bab_Checkpoint_Insurgents">Bab Checkpoint Insurgents</option>
                            <option value="Bab?Scenario=Scenario_Bab_Checkpoint_Security">Bab Checkpoint Security</option>
                            <option value="Bab?Scenario=Scenario_Bab_Domination">Bab Domination</option>
                            <option value="Bab?Scenario=Scenario_Bab_Firefight_East">Bab Firefight East</option>
                            <option value="Bab?Scenario=Scenario_Bab_Outpost">Bab Outpost</option>
                            <option value="Bab?Scenario=Scenario_Bab_Push_Insurgents">Bab Push Insurgents</option>
                            <option value="Bab?Scenario=Scenario_Bab_Push_Security">Bab Push Security</option>
                            <option value="Citadel?Scenario=Scenario_Citadel_Checkpoint_Insurgents">Citadel Checkpoint Insurgents</option>
                            <option value="Citadel?Scenario=Scenario_Citadel_Checkpoint_Security">Citadel Checkpoint Security</option>
                            <option value="Citadel?Scenario=Scenario_Citadel_Domination">Citadel Domination</option>
                            <option value="Citadel?Scenario=Scenario_Citadel_Firefight_East">Citadel Firefight East</option>
                            <option value="Citadel?Scenario=Scenario_Citadel_Outpost">Citadel Outpost</option>
                            <option value="Citadel?Scenario=Scenario_Citadel_Push_Insurgents">Citadel Push Insurgents</option>
                            <option value="Citadel?Scenario=Scenario_Citadel_Push_Security">Citadel Push Security</option>
                            <option value="Citadel?Scenario=Scenario_Citadel_Survival">Citadel Survival</option>
                            <option value="Citadel?Scenario=Scenario_Citadel_Defusal">Citadel Defusal</option>
                            <option value="Canyon?Scenario=Scenario_Crossing_Checkpoint_Insurgents">Crossing Checkpoint Insurgents</option>
                            <option value="Canyon?Scenario=Scenario_Crossing_Checkpoint_Security">Crossing Checkpoint Security</option>
                            <option value="Canyon?Scenario=Scenario_Crossing_Domination">Crossing Domination</option>
                            <option value="Canyon?Scenario=Scenario_Crossing_Firefight_West">Crossing Firefight West</option>
                            <option value="Farmhouse?Scenario=Scenario_Farmhouse_Checkpoint_Insurgents">Farmhouse Checkpoint Insurgents</option>
                            <option value="Farmhouse?Scenario=Scenario_Farmhouse_Checkpoint_Security">Farmhouse Checkpoint Security</option>
                            <option value="Town?Scenario=Scenario_Hideout_Checkpoint_Insurgents">Hideout Checkpoint Insurgents</option>
                            <option value="Town?Scenario=Scenario_Hideout_Checkpoint_Security">Hideout Checkpoint Security</option>
                            <option value="Town?Scenario=Scenario_Hideout_Push_Insurgents">Hideout Push Insurgents</option>
                            <option value="Town?Scenario=Scenario_Hideout_Push_Security">Hideout Push Security</option>
                            <option value="Ministry?Scenario=Scenario_Ministry_Checkpoint_Insurgents">Ministry Checkpoint Insurgents</option>
                            <option value="Ministry?Scenario=Scenario_Ministry_Checkpoint_Security">Ministry Checkpoint Security</option>
                            <option value="Compound?Scenario=Scenario_Outskirts_Checkpoint_Insurgents">Outskirts Checkpoint Insurgents</option>
                            <option value="Compound?Scenario=Scenario_Outskirts_Checkpoint_Security">Outskirts Checkpoint Security</option>
                            <option value="Precinct?Scenario=Scenario_Precinct_Checkpoint_Insurgents">Precinct Checkpoint Insurgents</option>
                            <option value="Precinct?Scenario=Scenario_Precinct_Checkpoint_Security">Precinct Checkpoint Security</option>
                            <option value="Precinct?Scenario=Scenario_Precinct_Push_Insurgents">Precinct Push Insurgents</option>
                            <option value="Precinct?Scenario=Scenario_Precinct_Push_Security">Precinct Push Security</option>
                            <option value="Oilfield?Scenario=Scenario_Refinery_Checkpoint_Insurgents">Refinery Checkpoint Insurgents</option>
                            <option value="Oilfield?Scenario=Scenario_Refinery_Checkpoint_Security">Refinery Checkpoint Security</option>
                            <option value="Mountain?Scenario=Scenario_Summit_Checkpoint_Insurgents">Summit Checkpoint Insurgents</option>
                            <option value="Mountain?Scenario=Scenario_Summit_Checkpoint_Security">Summit Checkpoint Security</option>
                            <option value="PowerPlant?Scenario=Scenario_PowerPlant_Checkpoint_Insurgents">PowerPlant Checkpoint Insurgents</option>
                            <option value="PowerPlant?Scenario=Scenario_PowerPlant_Checkpoint_Security">PowerPlant Checkpoint Security</option>
                            <option value="Tell?Scenario=Scenario_Tell_Checkpoint_Insurgents">Tell Checkpoint Insurgents</option>
                            <option value="Tell?Scenario=Scenario_Tell_Checkpoint_Security">Tell Checkpoint Security</option>
                            <option value="Buhriz?Scenario=Scenario_Tideway_Checkpoint_Insurgents">Tideway Checkpoint Insurgents</option>
                            <option value="Buhriz?Scenario=Scenario_Tideway_Checkpoint_Security">Tideway Checkpoint Security</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password (optional):</label>
                        <input type="text" id="password" name="password" placeholder="Enter password">
                    </div>
                    
                    <div class="form-group">
                        <label for="gameStatsToken">
                            <a href="https://gamestats.sandstorm.game/" target="_blank">GameStats Token</a>
                            <abbr title="Any Insurgency: Sandstorm community server can host a stats-enabled game. Enabling stats on your server also enables experience gain while playing on the server. The only requirement is that you must use a Steam GSLT, and you must not have a server password.">?</abbr>
                            (optional):
                        </label>
                        <input type="text" id="gameStatsToken" name="gameStatsToken" placeholder="Enter GameStats token">
                    </div>
                    
                    <div class="form-group">
                        <label for="gsltToken">
                            <a href="https://steamcommunity.com/dev/managegameservers" target="_blank">GSLT Token</a>
                            <abbr title="For your server to authenticate with the stats server, you must authenticate your server through Steam GSLT (Game Server Login Token). GSLTs can be obtained from Steam's Game Server Account Management page.">?</abbr>
                            (optional):
                        </label>
                        <input type="text" id="gsltToken" name="gsltToken" placeholder="Enter GSLT token">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enableGameStats" name="enableGameStats">
                            Enable GameStats
                            <abbr title="By default, the game servers will not attempt to report to the stats system. Following the GSLT login steps, adding -GameStats to your server's command line will enable the opt-in to the system.">?</abbr>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="officialRules" name="officialRules">
                            Use Official Rules
                            <abbr title="The game ships with a ruleset which are considered official rules; this locks down the options you can change on your dedicated server. If you are running a mostly vanilla server, you may consider opting into this ruleset for your server to appear under the 'official rules' filter. To opt-in, add -OfficialRules to your server's command line.">?</abbr>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enableCheats" name="enableCheats">
                            Enable Cheats
                        </label>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-primary btn-large" onclick="launchServer()">Launch Server</button>
                        <button type="button" class="btn btn-secondary" onclick="generateConfig()">Generate Config</button>
                    </div>
                </form>
                
                <div class="config-output">
                    <label for="configOutput">Generated Config:</label>
                    <textarea id="configOutput" readonly></textarea>
                </div>
                
                <div id="presetsContainer">
                    <h2>Presets</h2>
                    <div id="presetButtons"></div>
                    <div class="preset-actions">
                        <button type="button" class="btn btn-secondary" onclick="savePreset()">Save Preset</button>
                        <button type="button" class="btn btn-secondary" onclick="exportPresets()">Export Presets</button>
                        <button type="button" class="btn btn-secondary" onclick="importPresets()">Import Presets</button>
                    </div>
                </div>
            </div>
            
            <div id="mods" class="tab-content">
                <h2>Mods</h2>
                <div class="info-box">
                    Select mods to include with your server. The selected mods will be added to the server launch parameters.
                </div>
                
                <div class="search-box">
                    <input type="text" id="modSearch" placeholder="Search mods..." onkeyup="searchMods()">
                    <button type="button" class="btn btn-primary" onclick="searchMods()">Search</button>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="fetchMods()">Refresh Mod List</button>
                
                <div id="modCheckboxes">
                    <p>Loading mods list... Please wait or click "Refresh Mod List"</p>
                </div>
                
                <div>
                    <h3>Selected Mods:</h3>
                    <div id="selectedModsOutput"></div>
                </div>
            </div>
            
            <div id="mutators" class="tab-content">
                <h2>Mutators</h2>
                <div class="info-box">
                    Select mutators to enable on your server. Mutators change gameplay mechanics and rules.
                </div>
                
                <div class="search-box">
                    <input type="text" id="mutatorSearch" placeholder="Search mutators..." onkeyup="searchMutators()">
                    <button type="button" class="btn btn-primary" onclick="searchMutators()">Search</button>
                </div>
                
                <div id="mutatorCheckboxes">
                    <!-- Mutator checkboxes will be dynamically generated here -->
                </div>
                
                <div>
                    <h3>Selected Mutators:</h3>
                    <div id="selectedMutatorsOutput"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let mods = [];
        let selectedMods = [];
        let selectedMutators = [];

        // Mutators data
        const mutators = [
            { name: 'AllYouCanEat', description: 'Start with 100 supply points.' },
            { name: 'AntiMaterielRiflesOnly', description: 'Only anti-materiel rifles are available along with normal equipment and explosives.' },
            { name: 'BoltActionsOnly', description: 'Only bolt-action rifles are available along with normal equipment and explosives.' },
            { name: 'Broke', description: 'Start with 0 supply points.' },
            { name: 'BudgetAntiquing', description: 'Normal equipment and explosives, but limited to old and inexpensive weapons.' },
            { name: 'BulletSponge', description: 'Health is increased.' },
            { name: 'Competitive', description: 'Equipment is more expensive, rounds are shorter, and capturing objectives is faster.' },
            { name: 'CompetitiveLoadouts', description: 'Player classes are replaced with those from Competitive.' },
            { name: 'FastMovement', description: 'Move Faster.' },
            { name: 'Frenzy', description: 'Fight against AI enemies who only use melee attacks. Watch out for special enemies.' },
            { name: 'FullyLoaded', description: 'All weapons, equipment, and explosives in the game are available in the Loadout Menu' },
            { name: 'Guerrillas', description: 'Start with 5 supply points.' },
            { name: 'Gunslingers', description: 'Kill the enemy more than they kill you with a big stinkin revolver. And explosives.' },
            { name: 'Hardcore', description: 'Mutator featuring slower movement speeds and longer capture times.' },
            { name: 'HeadshotOnly', description: 'Players only take damage when shot in the head.' },
            { name: 'HotPotato', description: 'A live fragmentation grenade is dropped on death.' },
            { name: 'LockedAim', description: 'Weapons always point to the center of the screen.' },
            { name: 'MakarovsOnly', description: 'Makarovs are the only option.' },
            { name: 'NoAim', description: 'Aiming down sights is disabled.' },
            { name: 'NoDrops', description: 'No scavenging allowed.' },
            { name: 'PistolsOnly', description: 'Only pistols are available along with normal equipment and explosives.' },
            { name: 'Poor', description: 'Start with limited supply.' },
            { name: 'ShotgunsOnly', description: 'Only Shotguns are available along with normal equipment and explosives.' },
            { name: 'SlowCaptureTimes', description: 'Objectives will take longer to capture.' },
            { name: 'SlowMovement', description: 'Move slower.' },
            { name: 'SoldierOfFortune', description: 'Gain supply points as your score increases.' },
            { name: 'SpecialOperations', description: 'Start with 30 supply points.' },
            { name: 'Strapped', description: 'Start with 1 supply point.' },
            { name: 'Ultralethal', description: 'Everyone dies with one shot.' },
            { name: 'Vampirism', description: 'Receive health when dealing damage to enemies equal to the amount of damage dealt.' },
            { name: 'Warlords', description: 'Start with 10 supply points.' }
        ];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            generateMutatorCheckboxes();
            fetchMods();
            loadPresetsFromStorage();
        });

        // Tab switching
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tab");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Server configuration functions
        function generateConfig() {
            const os = document.getElementById('os').value;
            const hostname = document.getElementById('hostname').value;
            const maxPlayers = document.getElementById('maxPlayers').value;
            const port = document.getElementById('port').value;
            const queryPort = document.getElementById('queryPort').value;
            const scenario = document.getElementById('scenario').value;
            const password = document.getElementById('password').value;
            const enableCheats = document.getElementById('enableCheats').checked;
            const gameStatsToken = document.getElementById('gameStatsToken').value;
            const gsltToken = document.getElementById('gsltToken').value;
            const enableGameStats = document.getElementById('enableGameStats').checked;
            const officialRules = document.getElementById('officialRules').checked;

            let configString = "";
            const baseCommand = os === "windows" ?
                "InsurgencyServer.exe" :
                "Insurgency/Binaries/Linux/InsurgencyServer-Linux-Shipping";

            let travelParams = `${scenario}?MaxPlayers=${maxPlayers}`;

            if (password) travelParams += `?Password=${password}`;

            let gsltTokenParam = gsltToken ? ` -GSLTToken=${gsltToken}` : "";
            let cheatParam = enableCheats ? " -EnableCheats" : "";
            let gameStatsParam = (gameStatsToken && enableGameStats) ? ` -GameStatsToken=${gameStatsToken} -GameStats` : "";
            let officialRulesParam = officialRules ? " -ruleset=OfficialRules" : "";
            
            // Add mutators parameter
            let mutatorParam = selectedMutators.length > 0 ? ` -Mutators=${selectedMutators.join(',')}` : "";
            
            // Add mods parameter
            let modsParam = "";
            if (selectedMods.length > 0) {
                const modIds = selectedMods.map(mod => mod.id).join(',');
                modsParam = ` -mods -CmdModList=${modIds}`;
            }

            configString = `${baseCommand} ${travelParams} -Port=${port} -QueryPort=${queryPort} -log -hostname="${hostname}"${cheatParam}${gameStatsParam}${gsltTokenParam}${officialRulesParam}${mutatorParam}${modsParam}`;

            document.getElementById('configOutput').value = configString;
        }

        function launchServer() {
            generateConfig();
            
            const scenario = document.getElementById('scenario').value;
            const maxPlayers = document.getElementById('maxPlayers').value;
            const port = document.getElementById('port').value;
            const queryPort = document.getElementById('queryPort').value;
            const hostname = document.getElementById('hostname').value;
            const password = document.getElementById('password').value;
            const enableCheats = document.getElementById('enableCheats').checked;
            const gameStatsToken = document.getElementById('gameStatsToken').value;
            const gsltToken = document.getElementById('gsltToken').value;
            const enableGameStats = document.getElementById('enableGameStats').checked;
            const officialRules = document.getElementById('officialRules').checked;

            let serverParams = `${scenario}?MaxPlayers=${maxPlayers} -Port=${port} -QueryPort=${queryPort} -log -hostname="${hostname}"`;

            if (password) serverParams += `?Password=${password}`;
            if (enableCheats) serverParams += ' -EnableCheats';
            if (gameStatsToken && enableGameStats) serverParams += ` -GameStatsToken=${gameStatsToken} -GameStats`;
            if (gsltToken) serverParams += ` -GSLTToken=${gsltToken}`;
            if (officialRules) serverParams += ' -ruleset=OfficialRules';
            
            // Add mutators parameter
            if (selectedMutators.length > 0) {
                serverParams += ` -Mutators=${selectedMutators.join(',')}`;
            }
            
            // Add mods parameter
            if (selectedMods.length > 0) {
                const modIds = selectedMods.map(mod => mod.id).join(',');
                serverParams += ` -mods -CmdModList=${modIds}`;
            }

            const steamURL = `steam://rungameid/581330//${encodeURIComponent(serverParams)}`;
            window.location.href = steamURL;
        }

        function quickStart() {
            document.getElementById('hostname').value = 'My Insurgency Server';
            document.getElementById('maxPlayers').value = '24';
            document.getElementById('port').value = '27102';
            document.getElementById('queryPort').value = '27131';
            
            const scenarioDropdown = document.getElementById('scenario');
            const randomIndex = Math.floor(Math.random() * scenarioDropdown.options.length);
            scenarioDropdown.selectedIndex = randomIndex;
            
            launchServer();
        }

        // Preset functions
        function savePreset() {
            const presetName = prompt('Enter a name for the preset:');
            if (!presetName) return;
            
            const preset = {
                name: presetName,
                os: document.getElementById('os').value,
                hostname: document.getElementById('hostname').value,
                maxPlayers: document.getElementById('maxPlayers').value,
                port: document.getElementById('port').value,
                queryPort: document.getElementById('queryPort').value,
                scenario: document.getElementById('scenario').value,
                password: document.getElementById('password').value,
                enableCheats: document.getElementById('enableCheats').checked,
                gameStatsToken: document.getElementById('gameStatsToken').value,
                gsltToken: document.getElementById('gsltToken').value,
                enableGameStats: document.getElementById('enableGameStats').checked,
                officialRules: document.getElementById('officialRules').checked,
                selectedMutators: [...selectedMutators],
                selectedMods: [...selectedMods]
            };
            
            let presets = JSON.parse(localStorage.getItem('presets') || '[]');
            presets.push(preset);
            localStorage.setItem('presets', JSON.stringify(presets));
            renderPresetButtons(presets);
        }

        function loadPresetsFromStorage() {
            const presets = JSON.parse(localStorage.getItem('presets') || '[]');
            renderPresetButtons(presets);
        }

        function renderPresetButtons(presets) {
            const presetButtonsContainer = document.getElementById('presetButtons');
            presetButtonsContainer.innerHTML = '';
            
            presets.forEach((preset, index) => {
                const presetDiv = document.createElement('div');
                presetDiv.className = 'preset';

                const presetNameSpan = document.createElement('span');
                presetNameSpan.textContent = preset.name;

                const launchButton = document.createElement('button');
                launchButton.textContent = 'Launch';
                launchButton.className = 'btn btn-primary';
                launchButton.onclick = function() {
                    loadPreset(index);
                    launchServer();
                };

                const renameButton = document.createElement('button');
                renameButton.textContent = 'Rename';
                renameButton.className = 'btn btn-secondary';
                renameButton.onclick = function() {
                    renamePreset(index);
                };

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.className = 'btn btn-danger';
                deleteButton.onclick = function() {
                    deletePreset(index);
                };

                presetDiv.appendChild(presetNameSpan);
                presetDiv.appendChild(launchButton);
                presetDiv.appendChild(renameButton);
                presetDiv.appendChild(deleteButton);

                presetButtonsContainer.appendChild(presetDiv);
            });
        }

        function deletePreset(index) {
            const presets = JSON.parse(localStorage.getItem('presets') || '[]');
            presets.splice(index, 1);
            localStorage.setItem('presets', JSON.stringify(presets));
            renderPresetButtons(presets);
        }

        function renamePreset(index) {
            const presets = JSON.parse(localStorage.getItem('presets') || '[]');
            const newName = prompt('Enter a new name for the preset:', presets[index].name);
            if (newName) {
                presets[index].name = newName;
                localStorage.setItem('presets', JSON.stringify(presets));
                renderPresetButtons(presets);
            }
        }

        function loadPreset(index) {
            const presets = JSON.parse(localStorage.getItem('presets') || '[]');
            const preset = presets[index];
            if (!preset) return;
            
            document.getElementById('os').value = preset.os;
            document.getElementById('hostname').value = preset.hostname;
            document.getElementById('maxPlayers').value = preset.maxPlayers;
            document.getElementById('port').value = preset.port;
            document.getElementById('queryPort').value = preset.queryPort;
            document.getElementById('scenario').value = preset.scenario;
            document.getElementById('password').value = preset.password;
            document.getElementById('enableCheats').checked = preset.enableCheats;
            document.getElementById('gameStatsToken').value = preset.gameStatsToken;
            document.getElementById('gsltToken').value = preset.gsltToken;
            document.getElementById('enableGameStats').checked = preset.enableGameStats;
            document.getElementById('officialRules').checked = preset.officialRules;
            
            // Load saved mutators and mods
            selectedMutators = preset.selectedMutators || [];
            selectedMods = preset.selectedMods || [];
            
            updateMutatorCheckboxes();
            updateModCheckboxes();
            updateSelectedMutatorsDisplay();
            updateSelectedModsDisplay();
        }

        function exportPresets() {
            const presets = JSON.parse(localStorage.getItem('presets') || '[]');
            const presetsJSON = JSON.stringify(presets, null, 2);
            const blob = new Blob([presetsJSON], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'insurgency_server_presets.json';
            link.click();
        }

        function importPresets() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'application/json';
            fileInput.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const presetsJSON = e.target.result;
                        const presets = JSON.parse(presetsJSON);
                        localStorage.setItem('presets', JSON.stringify(presets));
                        renderPresetButtons(presets);
                        alert('Presets imported successfully!');
                    } catch (error) {
                        alert('Error importing presets: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            fileInput.click();
        }

        // Mutator functions
        function generateMutatorCheckboxes() {
            const mutatorCheckboxesContainer = document.getElementById('mutatorCheckboxes');
            mutatorCheckboxesContainer.innerHTML = '';
            
            mutators.forEach(mutator => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = mutator.name;
                checkbox.id = `mutator-${mutator.name}`;
                checkbox.checked = selectedMutators.includes(mutator.name);
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        if (!selectedMutators.includes(mutator.name)) {
                            selectedMutators.push(mutator.name);
                        }
                    } else {
                        const index = selectedMutators.indexOf(mutator.name);
                        if (index !== -1) {
                            selectedMutators.splice(index, 1);
                        }
                    }
                    updateSelectedMutatorsDisplay();
                });
                
                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = mutator.name;
                
                const description = document.createElement('div');
                description.className = 'item-description';
                description.textContent = mutator.description;
                
                checkboxItem.appendChild(checkbox);
                checkboxItem.appendChild(label);
                checkboxItem.appendChild(description);
                
                mutatorCheckboxesContainer.appendChild(checkboxItem);
            });
            
            updateSelectedMutatorsDisplay();
        }

        function updateMutatorCheckboxes() {
            const checkboxes = document.querySelectorAll('#mutatorCheckboxes input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectedMutators.includes(checkbox.value);
            });
        }

        function updateSelectedMutatorsDisplay() {
            const output = document.getElementById('selectedMutatorsOutput');
            if (selectedMutators.length === 0) {
                output.textContent = 'No mutators selected';
            } else {
                output.textContent = selectedMutators.join(', ');
            }
        }

        function searchMutators() {
            const searchTerm = document.getElementById('mutatorSearch').value.toLowerCase();
            const checkboxItems = document.querySelectorAll('#mutatorCheckboxes .checkbox-item');
            
            checkboxItems.forEach(item => {
                const label = item.querySelector('label').textContent.toLowerCase();
                const description = item.querySelector('.item-description').textContent.toLowerCase();
                
                if (label.includes(searchTerm) || description.includes(searchTerm)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Mod functions
        async function fetchMods() {
            try {
                // Add timestamp as query parameter to prevent caching
                const timestamp = new Date().getTime();
                const response = await fetch(`https://extremelystiff.github.io/ISSS/mods.json?t=${timestamp}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                mods = await response.json();
                generateModCheckboxes();
                console.log('Fetched mods:', mods);
            } catch (error) {
                console.error('Error fetching mods:', error);
                alert('Failed to fetch mods. Please try again later.');
                
                // Fallback to some example mods for testing
                mods = [
                    { id: 81844, name: "Example Content", summary: "Example Content from mod kit." },
                    { id: 89591, name: "Shoot House", summary: "Shoot House" },
                    { id: 91912, name: "Wolf-land (Nightfall 1.7 Update)", summary: "Update 0.6 - Added Night Lighting Scenario, temporarily disabled Checkpoint, various cover tweaks" },
                    { id: 92807, name: "M45A1 Wolfpack", summary: "Black variant of the M45A1" }
                ];
                generateModCheckboxes();
            }
        }

        function generateModCheckboxes() {
            const modCheckboxesContainer = document.getElementById('modCheckboxes');
            modCheckboxesContainer.innerHTML = '';
            
            if (!mods || mods.length === 0) {
                modCheckboxesContainer.innerHTML = '<p>No mods available. Please try refreshing the mod list.</p>';
                return;
            }
            
            mods.forEach(mod => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = mod.id;
                checkbox.id = `mod-${mod.id}`;
                checkbox.checked = selectedMods.some(selectedMod => selectedMod.id === mod.id);
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        if (!selectedMods.some(selectedMod => selectedMod.id === mod.id)) {
                            selectedMods.push(mod);
                        }
                    } else {
                        selectedMods = selectedMods.filter(selectedMod => selectedMod.id !== mod.id);
                    }
                    updateSelectedModsDisplay();
                });
                
                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = mod.name;
                
                const description = document.createElement('div');
                description.className = 'item-description';
                description.textContent = mod.summary || 'No description available';
                
                checkboxItem.appendChild(checkbox);
                checkboxItem.appendChild(label);
                checkboxItem.appendChild(description);
                
                modCheckboxesContainer.appendChild(checkboxItem);
            });
            
            updateSelectedModsDisplay();
        }

        function updateModCheckboxes() {
            const checkboxes = document.querySelectorAll('#modCheckboxes input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                const modId = parseInt(checkbox.value);
                checkbox.checked = selectedMods.some(mod => mod.id === modId);
            });
        }

        function updateSelectedModsDisplay() {
            const output = document.getElementById('selectedModsOutput');
            if (selectedMods.length === 0) {
                output.textContent = 'No mods selected';
            } else {
                let modInfo = selectedMods.map(mod => `${mod.name} (ID: ${mod.id})`).join('\n');
                output.textContent = modInfo;
            }
        }

        function searchMods() {
            const searchTerm = document.getElementById('modSearch').value.toLowerCase();
            const checkboxItems = document.querySelectorAll('#modCheckboxes .checkbox-item');
            
            checkboxItems.forEach(item => {
                const label = item.querySelector('label').textContent.toLowerCase();
                const description = item.querySelector('.item-description').textContent.toLowerCase();
                
                if (label.includes(searchTerm) || description.includes(searchTerm)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // GameStats token auto-check enableGameStats
        document.getElementById('gameStatsToken').addEventListener('input', function(e) {
            document.getElementById('enableGameStats').checked = !!e.target.value.trim();
        });
    </script>
</body>
</html>
