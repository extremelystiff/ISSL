<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <iframe src="https://extremelystiff.github.io/sandstormplayercount/widget.html" frameborder="0" scrolling="no" width="100%" height="auto"></iframe>
    <title>Insurgency Sandstorm Server Setup</title>
    <meta property="og:title" content="Insurgency: Sandstorm Server Launcher">
    <meta property="og:description" content="A powerful and user-friendly web application that allows you to effortlessly launch and configure your own Insurgency: Sandstorm dedicated server right from your browser.">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 1px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .quick-start {
            text-align: center;
            margin-bottom: 30px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 5px;
            font-weight: 500;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn-large {
            font-size: 1.2em;
            padding: 15px 25px;
        }

        .btn:hover {
            opacity: 0.9;
        }

        #serverForm {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        #serverForm label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        #serverForm input,
        #serverForm select {
            width: 95%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-actions {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .config-output {
            margin-top: 30px;
            width: 100%;
        }

        #configOutput {
            width: 100%;
            height: 200px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }

        #presetsContainer {
            margin-top: 30px;
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
        }

        #presetButtons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .preset {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #fff;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .preset-actions {
            display: flex;
            gap: 10px;
        }

        h1, h2 {
            color: #2c3e50;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: bold;
            color: #777;
            transition: color 0.3s;
        }

        .tab.active {
            color: #3498db;
            border-bottom: 2px solid #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .mutator-section {
            margin-top: 20px;
        }

        .mod-section {
            margin-top: 20px;
        }

        details {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }

        summary {
            font-weight: bold;
            cursor: pointer;
            padding: 5px;
        }

        #mutatorCheckboxes, #modCheckboxes {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .checkbox-item:hover {
            background-color: #f9f9f9;
        }

        .checkbox-item label {
            margin-left: 10px;
            flex: 1;
        }

        .item-description {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
            margin-left: 25px;
        }

        #selectedModsOutput, #selectedMutatorsOutput {
            margin-top: 10px;
            width: 100%;
            min-height: 100px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
        }

        .info-box {
            background-color: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .search-box {
            display: flex;
            margin-bottom: 10px;
        }

        .search-box input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
        }

        .search-box button {
            border-radius: 0 4px 4px 0;
            padding: 8px 12px;
        }

        abbr {
            text-decoration: none;
            border-bottom: 1px dotted #666;
            cursor: help;
        }
  /* Mutator Suggestions Styling */
  .mutator-suggestions {
    margin-top: 20px;
    padding: 15px;
    background-color: #e3f2fd;
    border-radius: 4px;
    border-left: 4px solid #2196F3;
  }
  
  .suggestion-box {
    margin-bottom: 10px;
    padding: 12px;
    background-color: #fff;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }
  
  .suggestion-box:hover {
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  
  .suggestion-mod-name {
    font-weight: bold;
    margin-bottom: 3px;
  }
  
  .suggestion-mutator-name {
    color: #0d47a1;
  }
  
  .suggestion-description {
    font-size: 0.9em;
    color: #666;
    margin-top: 5px;
    margin-bottom: 10px;
  }
  
  .apply-suggestion {
    padding: 5px 10px;
    font-size: 0.85em;
  }
  
  .highlight-mutator {
    animation: highlight-pulse 2s ease-in-out;
  }
  
  @keyframes highlight-pulse {
    0% { background-color: #ffffff; }
    50% { background-color: #e3f2fd; }
    100% { background-color: #ffffff; }
  }
  
  /* Add notification styling */
  .notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #4CAF50;
    color: white;
    padding: 15px 20px;
    border-radius: 4px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    z-index: 1000;
    transition: opacity 0.5s ease;
    opacity: 0;
  }
  
  .notification.show {
    opacity: 1;
  }
  
  /* Tooltip improvements */
  abbr[title] {
    position: relative;
    cursor: help;
  }
  
  abbr[title]:hover::after {
    content: attr(title);
    position: absolute;
    left: 100%;
    top: -5px;
    background-color: #333;
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    z-index: 10;
    width: 200px;
    font-size: 0.8em;
    white-space: normal;
  }
    </style>
</head>
<body>
    <div class="container">
        <h1>Insurgency Sandstorm Server Setup</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'serverConfig')">Server Configuration</button>
            <button class="tab" onclick="openTab(event, 'mods')">Mods</button>
            <button class="tab" onclick="openTab(event, 'mutators')">Mutators</button>
        </div>
        
        <div class="main-content">
            <div id="serverConfig" class="tab-content active">
                <div class="quick-start">
                    <button id="quickStartButton" class="btn btn-primary btn-large" onclick="quickStart()">Quick Launch Random Map Server</button>
                </div>
                
                <h2>Server Configuration</h2>
                <form id="serverForm">
                    <div class="form-group">
                        <label for="os">Operating System:</label>
                        <select name="os" id="os">
                            <option value="windows">Windows</option>
                            <option value="linux">Linux</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="hostname">Server Name:</label>
                        <input type="text" id="hostname" name="hostname" placeholder="Enter server name">
                    </div>
                    
                    <div class="form-group">
                        <label for="maxPlayers">Max Players:</label>
                        <input type="number" id="maxPlayers" name="maxPlayers" placeholder="24" min="1" max="99" value="24">
                    </div>
                    
                    <div class="form-group">
                        <label for="port">
                            Game Port
                            <abbr title="For your server to show up on the server browser, you will have to forward both TCP and UDP. You can find tutorials on port forwarding on a lot of websites. We suggest portforward.com, which offers tutorials for most router manufacturers.">?</abbr>:
                        </label>
                        <input type="number" id="port" name="port" placeholder="27102" min="1" max="65535" value="27102">
                    </div>
                    
                    <div class="form-group">
                        <label for="queryPort">
                            Query Port
                            <abbr title="The query port is used by the server browser to retrieve information about your server. It should be a different port than the game port.">?</abbr>:
                        </label>
                        <input type="number" id="queryPort" name="queryPort" placeholder="27131" min="1" max="65535" value="27131">
                    </div>
                    
                    <div class="form-group">
                        <label for="scenario">Choose a Scenario:</label>
                        <select name="scenario" id="scenario">
                			<option value="Bab?Scenario=Scenario_Bab_Checkpoint_Insurgents">Bab Checkpoint Insurgents</option>
                			<option value="Bab?Scenario=Scenario_Bab_Checkpoint_Security">Bab Checkpoint Security</option>
                			<option value="Bab?Scenario=Scenario_Bab_Domination">Bab Domination</option>
                			<option value="Bab?Scenario=Scenario_Bab_Firefight_East">Bab Firefight East</option>
                			<option value="Bab?Scenario=Scenario_Bab_Outpost">Bab Outpost</option>
                			<option value="Bab?Scenario=Scenario_Bab_Push_Insurgents">Bab Push Insurgents</option>
                			<option value="Bab?Scenario=Scenario_Bab_Push_Security">Bab Push Security</option>
                			<option value="Citadel?Scenario=Scenario_Citadel_Ambush">Citadel Ambush</option>
                			<option value="Citadel?Scenario=Scenario_Citadel_Checkpoint_Insurgents">Citadel Checkpoint Insurgents</option>
                			<option value="Citadel?Scenario=Scenario_Citadel_Checkpoint_Security">Citadel Checkpoint Security</option>
                			<option value="Citadel?Scenario=Scenario_Citadel_Domination">Citadel Domination</option>
                			<option value="Citadel?Scenario=Scenario_Citadel_Firefight_East">Citadel Firefight East</option>
                			<option value="Citadel?Scenario=Scenario_Citadel_Outpost">Citadel Outpost</option>
                			<option value="Citadel?Scenario=Scenario_Citadel_Push_Insurgents">Citadel Push Insurgents</option>
                			<option value="Citadel?Scenario=Scenario_Citadel_Push_Security">Citadel Push Security</option>
                			<option value="Citadel?Scenario=Scenario_Citadel_Survival">Citadel Survival</option>
                			<option value="Citadel?Scenario=Scenario_Citadel_Defusal">Citadel Defusal</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Ambush">Crossing Ambush</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Checkpoint_Insurgents">Crossing Checkpoint Insurgents</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Checkpoint_Security">Crossing Checkpoint Security</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Domination">Crossing Domination</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Firefight_West">Crossing Firefight West</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Frontline">Crossing Frontline</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Outpost">Crossing Outpost</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Push_Insurgents">Crossing Push Insurgents</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Push_Security">Crossing Push Security</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Skirmish">Crossing Skirmish</option>
                			<option value="Canyon?Scenario=Scenario_Crossing_Team_Deathmatch">Crossing Team Deathmatch</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Ambush">Farmhouse Ambush</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Checkpoint_Insurgents">Farmhouse Checkpoint Insurgents</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Checkpoint_Security">Farmhouse Checkpoint Security</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Domination">Farmhouse Domination</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Firefight_East">Farmhouse Firefight East</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Firefight_West">Farmhouse Firefight West</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Frontline">Farmhouse Frontline</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Push_Insurgents">Farmhouse Push Insurgents</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Push_Security">Farmhouse Push Security</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Skirmish">Farmhouse Skirmish</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Survival">Farmhouse Survival</option>
                			<option value="Farmhouse?Scenario=Scenario_Farmhouse_Team_Deathmatch">Farmhouse Team Deathmatch</option>
                			<option value=Gap?Scenario=Scenario_Gap_Ambush">Gap Ambush</option>
                			<option value=Gap?Scenario=Scenario_Gap_Checkpoint_Insurgents">Gap Checkpoint Insurgents</option>
                			<option value=Gap?Scenario=Scenario_Gap_Checkpoint_Security">Gap Checkpoint Security</option>
                			<option value=Gap?Scenario=Scenario_Gap_Domination">Gap Domination</option>
                			<option value=Gap?Scenario=Scenario_Gap_Firefight">Gap Firefight</option>
                			<option value=Gap?Scenario=Scenario_Gap_Frontline">Gap Frontline</option>
                			<option value=Gap?Scenario=Scenario_Gap_Outpost">Gap Outpost</option>
                			<option value=Gap?Scenario=Scenario_Gap_Push_Insurgents">Gap Push Insurgents</option>
                			<option value=Gap?Scenario=Scenario_Gap_Push_Security">Gap Push Security</option>
                			<option value=Gap?Scenario=Scenario_Gap_Survival">Gap Survival</option>
                			<option value=Gap?Scenario=Scenario_Gap_Defusal">Gap Defusal</option>
                			<option value="Town?Scenario=Scenario_Hideout_Ambush">Hideout Ambush</option>
                			<option value="Town?Scenario=Scenario_Hideout_Checkpoint_Insurgents">Hideout Checkpoint Insurgents</option>
                			<option value="Town?Scenario=Scenario_Hideout_Checkpoint_Security">Hideout Checkpoint Security</option>
                			<option value="Town?Scenario=Scenario_Hideout_Domination">Hideout Domination</option>
                			<option value="Town?Scenario=Scenario_Hideout_Firefight_East">Hideout Firefight East</option>
                			<option value="Town?Scenario=Scenario_Hideout_Firefight_West">Hideout Firefight West</option>
                			<option value="Town?Scenario=Scenario_Hideout_Frontline">Hideout Frontline</option>
                			<option value="Town?Scenario=Scenario_Hideout_Push_Insurgents">Hideout Push Insurgents</option>
                			<option value="Town?Scenario=Scenario_Hideout_Push_Security">Hideout Push Security</option>
                			<option value="Town?Scenario=Scenario_Hideout_Skirmish">Hideout Skirmish</option>
                			<option value="Town?Scenario=Scenario_Hideout_Survival">Hideout Survival</option>
                			<option value="Town?Scenario=Scenario_Hideout_Team_Deathmatch">Hideout Team Deathmatch</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Ambush">Hillside Ambush</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Checkpoint_Insurgents">Hillside Checkpoint Insurgents</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Checkpoint_Security">Hillside Checkpoint Security</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Domination">Hillside Domination</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Firefight_East">Hillside Firefight East</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Firefight_West">Hillside Firefight West</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Frontline">Hillside Frontline</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Outpost">Hillside Outpost</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Push_Insurgents">Hillside Push Insurgents</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Push_Security">Hillside Push Security (INS2014 layout)</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Skirmish">Hillside Skirmish</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Survival">Hillside Survival</option>
                			<option value="Sinjar?Scenario=Scenario_Hillside_Team_Deathmatch">Hillside Team Deathmatch</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Push_Security">LastLight Push Security</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Checkpoint_Insurgents">LastLight Checkpoint Insurgents</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Checkpoint_Security">LastLight Checkpoint Security</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Domination">LastLight Domination</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Firefight">LastLight Firefight</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Ambush"LastLight >Ambush</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Survival">LastLight Survival</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Push_Insurgents">LastLight Push Insurgents</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Push_Security">LastLight Push Security</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Outpost">LastLight Outpost</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Defusal">LastLight Defusal</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Frontline">LastLight Frontline</option>
                			<option value="LastLight?Scenario=Scenario_LastLight_Team_Deathmatch">LastLight Team Deathmatch</option>
                			<option value="Ministry?Scenario=Scenario_Ministry_Ambush">Ministry Ambush</option>
                			<option value="Ministry?Scenario=Scenario_Ministry_Checkpoint_Insurgents">Ministry Checkpoint Insurgents</option>
                			<option value="Ministry?Scenario=Scenario_Ministry_Checkpoint_Security">Ministry Checkpoint Security</option>
                			<option value="Ministry?Scenario=Scenario_Ministry_Domination">Ministry Domination</option>
                			<option value="Ministry?Scenario=Scenario_Ministry_Firefight_A">Ministry Firefight</option>
                			<option value="Ministry?Scenario=Scenario_Ministry_Skirmish">Ministry Skirmish</option>
                			<option value="Ministry?Scenario=Scenario_Ministry_Team_Deathmatch">Ministry Team Deathmatch</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Checkpoint_Insurgents">Outskirts Checkpoint Insurgents</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Checkpoint_Security">Outskirts Checkpoint Security</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Firefight_East">Outskirts Firefight East</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Firefight_West">Outskirts Firefight West</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Frontline">Outskirts Frontline</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Push_Insurgents">Outskirts Push Insurgents</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Push_Security">Outskirts Push Security</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Skirmish">Outskirts Skirmish</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Team_Deathmatch">Outskirts Team Deathmatch</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Survival">Outskirts Survival</option>
                			<option value=Compound?Scenario=Scenario_Outskirts_Defusal">Outskirts Defusal</option>
                			<option value="PowerPlant?Scenario=Scenario_PowerPlant_Ambush">PowerPlant Ambush</option>
                			<option value="PowerPlant?Scenario=Scenario_PowerPlant_Checkpoint_Insurgents">PowerPlant Checkpoint Insurgents</option>
                			<option value="PowerPlant?Scenario=Scenario_PowerPlant_Checkpoint_Security">PowerPlant Checkpoint Security</option>
                			<option value="PowerPlant?Scenario=Scenario_PowerPlant_Domination">PowerPlant Domination</option>
                			<option value="PowerPlant?Scenario=Scenario_PowerPlant_Firefight_East">PowerPlant Firefight East</option>
                			<option value="PowerPlant?Scenario=Scenario_PowerPlant_Firefight_West">PowerPlant Firefight West</option>
                			<option value="PowerPlant?Scenario=Scenario_PowerPlant_Push_Insurgents">PowerPlant Push Insurgents</option>
                			<option value="PowerPlant?Scenario=Scenario_PowerPlant_Push_Security">PowerPlant Push Security</option>
                			<option value="PowerPlant?Scenario=Scenario_PowerPlant_Survival">PowerPlant Survival</option>
                			<option value="PowerPlant?Scenario=Scenario_PowerPlant_Frontline">PowerPlant Frontline</option>	
                			<option value="Precinct?Scenario=Scenario_Precinct_Ambush">Precinct Ambush</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Checkpoint_Insurgents">Precinct Checkpoint Insurgents</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Checkpoint_Security">Precinct Checkpoint Security</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Firefight_East">Precinct Firefight East</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Firefight_West">Precinct Firefight West</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Frontline">Precinct Frontline</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Push_Insurgents">Precinct Push Insurgents</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Push_Security">Precinct Push Security</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Skirmish">Precinct Skirmish</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Team_Deathmatch">Precinct Team Deathmatch</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Survival">Precinct Survival</option>
                			<option value="Precinct?Scenario=Scenario_Precinct_Defusal">Precinct Defusal</option>
                			<option value="Prison?Scenario=Scenario_Prison_Push_Security">Prison Push Security</option>
                			<option value="Prison?Scenario=Scenario_Prison_Checkpoint_Insurgents">Prison Checkpoint Insurgents</option>
                			<option value="Prison?Scenario=Scenario_Prison_Checkpoint_Security">Prison Checkpoint Security</option>
                			<option value="Prison?Scenario=Scenario_Prison_Domination">Prison Domination</option>
                			<option value="Prison?Scenario=Scenario_Prison_Firefight">Prison Firefight</option>
                			<option value="Prison?Scenario=Scenario_Prison_Ambush">Prison Ambush</option>
                			<option value="Prison?Scenario=Scenario_Prison_Survival">Prison Survival</option>
                			<option value="Prison?Scenario=Scenario_Prison_Push_Insurgents">Prison Push Insurgents</option>
                			<option value="Prison?Scenario=Scenario_Prison_Push_Security">Prison Push Security</option>
                			<option value="Prison?Scenario=Scenario_Prison_Defusal">Prison Defusal</option>
                			<option value="Oilfield?Scenario=Scenario_Refinery_Push_Security">Refinery Push Security</option>    
                			<option value="Oilfield?Scenario=Scenario_Refinery_Ambush">Refinery Ambush</option>
                			<option value="Oilfield?Scenario=Scenario_Refinery_Checkpoint_Insurgents">Refinery Checkpoint Insurgents</option>
                			<option value="Oilfield?Scenario=Scenario_Refinery_Checkpoint_Security">Refinery Checkpoint Security</option>
                			<option value="Oilfield?Scenario=Scenario_Refinery_Domination">Refinery Domination</option>
                			<option value="Oilfield?Scenario=Scenario_Refinery_Firefight_West">Refinery Firefight West</option>
                			<option value="Oilfield?Scenario=Scenario_Refinery_Frontline">Refinery Frontline</option>
                			<option value="Oilfield?Scenario=Scenario_Refinery_Push_Insurgents">Refinery Push Insurgents</option>
                			<option value="Oilfield?Scenario=Scenario_Refinery_Push_Security">Refinery Push Security</option>
                			<option value="Oilfield?Scenario=Scenario_Refinery_Skirmish">Refinery Skirmish</option>
                			<option value="Oilfield?Scenario=Scenario_Refinery_Survival">Refinery Survival</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Ambush">Summit Ambush</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Checkpoint_Insurgents">Summit Checkpoint Insurgents</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Checkpoint_Security">Summit Checkpoint Security</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Firefight_East">Summit Firefight East</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Firefight_West">Summit Firefight West</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Frontline">Summit Frontline</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Push_Insurgents">Summit Push Insurgents</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Push_Security">Summit Push Security</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Skirmish">Summit Skirmish</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Team_Deathmatch">Summit Team Deathmatch</option>
                			<option value="Mountain?Scenario=Scenario_Summit_Survival">Summit Survival</option>
                			<option value="Tell?Scenario=Scenario_Tell_Ambush">Tell Ambush</option>
                			<option value="Tell?Scenario=Scenario_Tell_Checkpoint_Insurgents">Tell Checkpoint Insurgents</option>
                			<option value="Tell?Scenario=Scenario_Tell_Checkpoint_Security">Tell Checkpoint Security</option>
                			<option value="Tell?Scenario=Scenario_Tell_Domination">Tell Domination</option>
                			<option value="Tell?Scenario=Scenario_Tell_Firefight_East">Tell Firefight East</option>
                			<option value="Tell?Scenario=Scenario_Tell_Firefight_West">Tell Firefight West</option>
                			<option value="Tell?Scenario=Scenario_Tell_Outpost">Tell Outpost</option>
                			<option value="Tell?Scenario=Scenario_Tell_Push_Insurgents">Tell Push Insurgents</option>
                			<option value="Tell?Scenario=Scenario_Tell_Push_Security">Tell Push Security</option>
                			<option value="Tell?Scenario=Scenario_Tell_Survival">Tell Survival</option>
                			<option value="Tell?Scenario=Scenario_Tell_Frontline">Tell Frontline</option>
                			<option value="Buhriz?Scenario=Scenario_Tideway_Checkpoint_Insurgents">Tideway Checkpoint Insurgents</option>
                			<option value="Buhriz?Scenario=Scenario_Tideway_Checkpoint_Security">Tideway Checkpoint Security</option>
                			<option value="Buhriz?Scenario=Scenario_Tideway_Domination">Tideway Domination</option>
                			<option value="Buhriz?Scenario=Scenario_Tideway_Firefight_West">Tideway Firefight West</option>
                			<option value="Buhriz?Scenario=Scenario_Tideway_Frontline">Tideway Frontline</option>
                			<option value="Buhriz?Scenario=Scenario_Tideway_Push_Insurgents">Tideway Push Insurgents</option>
                			<option value="Buhriz?Scenario=Scenario_Tideway_Push_Security">Tideway Push Security</option>
                			<option value="Buhriz?Scenario=Scenario_Tideway_Survival">Tideway Survival</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Push_Security">Trainyard Push Security</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Push_Insurgents">Trainyard Push Insurgents</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Firefight_West">Trainyard Firefight West</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Firefight_East">Trainyard Firefight East</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Domination_West">Trainyard Domination West</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Domination_East">Trainyard Domination East</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Frontline">Trainyard Frontline</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Ambush_East">Trainyard Ambush East</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Ambush_West">Trainyard Ambush West</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Defusal_West">Trainyard Defusal West</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Checkpoint_Security">Trainyard Checkpoint Security</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Checkpoint_Insurgents">Trainyard Checkpoint Insurgents</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Outpost">Trainyard Outpost</option>
                			<option value="Trainyard?Scenario=Scenario_Trainyard_Survival">Trainyard Survival</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password (optional):</label>
                        <input type="text" id="password" name="password" placeholder="Enter password">
                    </div>
                    
                    <div class="form-group">
                        <label for="gameStatsToken">
                            <a href="https://gamestats.sandstorm.game/" target="_blank">GameStats Token</a>
                            <abbr title="Any Insurgency: Sandstorm community server can host a stats-enabled game. Enabling stats on your server also enables experience gain while playing on the server. The only requirement is that you must use a Steam GSLT, and you must not have a server password.">?</abbr>
                            (optional):
                        </label>
                        <input type="text" id="gameStatsToken" name="gameStatsToken" placeholder="Enter GameStats token">
                    </div>
                    
                    <div class="form-group">
                        <label for="gsltToken">
                            <a href="https://steamcommunity.com/dev/managegameservers" target="_blank">GSLT Token</a>
                            <abbr title="For your server to authenticate with the stats server, you must authenticate your server through Steam GSLT (Game Server Login Token). GSLTs can be obtained from Steam's Game Server Account Management page.">?</abbr>
                            (optional):
                        </label>
                        <input type="text" id="gsltToken" name="gsltToken" placeholder="Enter GSLT token">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enableGameStats" name="enableGameStats">
                            Enable GameStats
                            <abbr title="By default, the game servers will not attempt to report to the stats system. Following the GSLT login steps, adding -GameStats to your server's command line will enable the opt-in to the system.">?</abbr>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="officialRules" name="officialRules">
                            Use Official Rules
                            <abbr title="The game ships with a ruleset which are considered official rules; this locks down the options you can change on your dedicated server. If you are running a mostly vanilla server, you may consider opting into this ruleset for your server to appear under the 'official rules' filter. To opt-in, add -OfficialRules to your server's command line.">?</abbr>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enableCheats" name="enableCheats">
                            Enable Cheats
                        </label>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-primary btn-large" onclick="launchServer()">Launch Server</button>
                        <button type="button" class="btn btn-secondary" onclick="generateConfig()">Generate Config</button>
                    </div>
                </form>
                
                <div class="config-output">
                    <label for="configOutput">Generated Config:</label>
                    <textarea id="configOutput" readonly></textarea>
                </div>
                
                <div id="presetsContainer">
                    <h2>Presets</h2>
                    <div id="presetButtons"></div>
                    <div class="preset-actions">
                        <button type="button" class="btn btn-secondary" onclick="savePreset()">Save Preset</button>
                        <button type="button" class="btn btn-secondary" onclick="exportPresets()">Export Presets</button>
                        <button type="button" class="btn btn-secondary" onclick="importPresets()">Import Presets</button>
                    </div>
                </div>
            </div>
            
            <div id="mods" class="tab-content">
                <h2>Mods</h2>
                <div class="info-box">
                    Select mods to include with your server. The selected mods will be added to the server launch parameters.
                </div>
                
                <div class="search-box">
                    <input type="text" id="modSearch" placeholder="Search mods..." onkeyup="searchMods()">
                    <button type="button" class="btn btn-primary" onclick="searchMods()">Search</button>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="fetchMods()">Refresh Mod List</button>
                
                <div id="modCheckboxes">
                    <p>Loading mods list... Please wait or click "Refresh Mod List"</p>
                </div>
                
                <div>
                    <h3>Selected Mods:</h3>
                    <div id="selectedModsOutput"></div>
                </div

                <div id="mutatorSuggestions" class="mutator-suggestions" style="display: none;">
                  <h3>Suggested Mutators <button id="refreshSuggestions" class="btn btn-secondary btn-sm">Refresh Suggestions</button></h3>
                  <div id="suggestionsContent"></div>
                </div>

            </div>
            
            <div id="mutators" class="tab-content">
                <h2>Mutators</h2>
                <div class="info-box">
                    Select mutators to enable on your server. Mutators change gameplay mechanics and rules.
                </div>
                
                <div class="search-box">
                    <input type="text" id="mutatorSearch" placeholder="Search mutators..." onkeyup="searchMutators()">
                    <button type="button" class="btn btn-primary" onclick="searchMutators()">Search</button>
                </div>
                
                <div id="mutatorCheckboxes">
                    <!-- Mutator checkboxes will be dynamically generated here -->
                </div>
                
                <div>
                    <h3>Selected Mutators:</h3>
                    <div id="selectedMutatorsOutput"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>
    

    <div id="suggestionInfoModal" class="modal" style="display: none;">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Mod-Based Mutator Suggestions</h2>
        <p>Many Insurgency: Sandstorm mods require specific mutators to be enabled to work correctly.</p>
        <p>This feature will automatically suggest appropriate mutators based on the mods you select.</p>
        <p>When you select a mod that needs a special mutator, you'll see suggestions appear here.</p>
        <div class="form-group">
          <label>
            <input type="checkbox" id="dontShowAgain"> Don't show this message again
          </label>
        </div>
        <button class="btn btn-primary" onclick="closeInfoModal()">Got it!</button>
      </div>
    </div>

    <script>
        // Global variables
        let mods = [];
        let selectedMods = [];
        let customMutators = [];
        let selectedMutators = [];

        let modMutatorSuggestions = {
          // Format: modId: { name, suggestedMutator, description, popularity }
          // Common mod-mutator relationships based on community knowledge
          "89591": { 
            name: "Shoot House", 
            suggestedMutator: "Competitive", 
            description: "Competitive mutator improves the training experience on this map",
            popularity: 0.85
          },
          "91912": { 
            name: "Wolf-land (Nightfall 1.7 Update)", 
            suggestedMutator: "Hardcore", 
            description: "Hardcore mutator enhances the nighttime atmosphere",
            popularity: 0.9
          },
          "92807": { 
            name: "M45A1 Wolfpack", 
            suggestedMutator: "FullyLoaded", 
            description: "Makes all weapons available including this mod",
            popularity: 0.75
          },
          // Add more known relationships here as you discover them
        };



        // Load custom mutators from local storage on page load
        function loadCustomMutators() {
          try {
            const savedMutators = localStorage.getItem('customMutators');
            if (savedMutators) {
              customMutators = JSON.parse(savedMutators);
              console.log('Loaded custom mutators:', customMutators);
            }
          } catch (error) {
            console.error('Error loading custom mutators:', error);
            customMutators = [];
          }
        }
        
        // Function to add custom mutator
        function addCustomMutator() {
          const mutatorInput = document.getElementById('customMutatorInput');
          const mutatorName = mutatorInput.value.trim();
          
          if (!mutatorName) {
            alert('Please enter a mutator name');
            return;
          }
          
          // Check if already in standard mutators
          const existingStandardMutator = mutators.find(m => m.name.toLowerCase() === mutatorName.toLowerCase());
          if (existingStandardMutator) {
            alert('This mutator already exists in the standard list');
            return;
          }
          
          // Check if already in custom mutators
          const existingCustomMutator = customMutators.find(m => m.name.toLowerCase() === mutatorName.toLowerCase());
          if (existingCustomMutator) {
            alert('This custom mutator has already been added');
            return;
          }
          
          // Add to custom mutators
          const newMutator = { name: mutatorName, description: 'Custom user-added mutator', isCustom: true };
          customMutators.push(newMutator);
          
          // Save to local storage
          localStorage.setItem('customMutators', JSON.stringify(customMutators));
          
          // Add to selected mutators
          if (!selectedMutators.includes(mutatorName)) {
            selectedMutators.push(mutatorName);
          }
          
          // Clear input
          mutatorInput.value = '';
          
          // Regenerate the mutator checkboxes to include the new custom mutator
          generateMutatorCheckboxes();
          
          // Log to GAS if mods are selected
          if (selectedMods && selectedMods.length > 0) {
            logCustomMutatorToGAS(mutatorName);
          }
        }

        function logSelectedCustomMutators() {
          // Only proceed if there are mods and custom mutators selected
          if (!selectedMods || selectedMods.length === 0) return;
          
          // Find which custom mutators are currently selected
          const selectedCustomMutatorNames = selectedMutators.filter(mutatorName => {
            // Check if this is a custom mutator (not in standard mutators list)
            return !mutators.some(m => m.name === mutatorName) && 
                   customMutators.some(m => m.name === mutatorName);
          });
          
          // Log each selected custom mutator
          if (selectedCustomMutatorNames.length > 0) {
            selectedCustomMutatorNames.forEach(mutatorName => {
              logCustomMutatorToGAS(mutatorName);
            });
          }
        }
        
        // Generate mutator checkboxes
        function generateMutatorCheckboxes() {
          const mutatorCheckboxesContainer = document.getElementById('mutatorCheckboxes');
          mutatorCheckboxesContainer.innerHTML = '';
          
          // Create standard mutators
          mutators.forEach(mutator => {
            const checkboxItem = document.createElement('div');
            checkboxItem.className = 'checkbox-item';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = mutator.name;
            checkbox.id = `mutator-${mutator.name}`;
            checkbox.checked = selectedMutators.includes(mutator.name);
            checkbox.addEventListener('change', function() {
              if (this.checked) {
                if (!selectedMutators.includes(mutator.name)) {
                  selectedMutators.push(mutator.name);
                }
              } else {
                const index = selectedMutators.indexOf(mutator.name);
                if (index !== -1) {
                  selectedMutators.splice(index, 1);
                }
              }
              updateSelectedMutatorsDisplay();
            });
            
            const label = document.createElement('label');
            label.htmlFor = checkbox.id;
            label.textContent = mutator.name;
            
            const description = document.createElement('div');
            description.className = 'item-description';
            description.textContent = mutator.description;
            
            checkboxItem.appendChild(checkbox);
            checkboxItem.appendChild(label);
            checkboxItem.appendChild(description);
            
            mutatorCheckboxesContainer.appendChild(checkboxItem);
          });
          
          // Add custom mutators if any exist
          if (customMutators && customMutators.length > 0) {
            // Add a divider
            const divider = document.createElement('div');
            divider.className = 'mutator-divider';
            divider.innerHTML = '<h3>Custom Mutators</h3>';
            mutatorCheckboxesContainer.appendChild(divider);
            
            // Add each custom mutator
            customMutators.forEach(mutator => {
              const checkboxItem = document.createElement('div');
              checkboxItem.className = 'checkbox-item custom-mutator-item';
              
              const checkbox = document.createElement('input');
              checkbox.type = 'checkbox';
              checkbox.value = mutator.name;
              checkbox.id = `mutator-custom-${mutator.name}`;
              checkbox.checked = selectedMutators.includes(mutator.name);
              checkbox.addEventListener('change', function() {
                if (this.checked) {
                  if (!selectedMutators.includes(mutator.name)) {
                    selectedMutators.push(mutator.name);
                  }
                } else {
                  const index = selectedMutators.indexOf(mutator.name);
                  if (index !== -1) {
                    selectedMutators.splice(index, 1);
                  }
                }
                updateSelectedMutatorsDisplay();
              });
              
              const label = document.createElement('label');
              label.htmlFor = checkbox.id;
              label.textContent = mutator.name;
              
              const description = document.createElement('div');
              description.className = 'item-description';
              description.textContent = mutator.description || 'Custom user-added mutator';
              
              const deleteButton = document.createElement('button');
              deleteButton.className = 'btn btn-danger btn-sm';
              deleteButton.textContent = 'Delete';
              deleteButton.style.marginLeft = '10px';
              deleteButton.onclick = function(e) {
                e.preventDefault(); // Prevent event bubbling
                deleteCustomMutator(mutator.name);
              };
              
              checkboxItem.appendChild(checkbox);
              checkboxItem.appendChild(label);
              checkboxItem.appendChild(deleteButton);
              checkboxItem.appendChild(description);
              
              mutatorCheckboxesContainer.appendChild(checkboxItem);
            });
          }
          
          updateSelectedMutatorsDisplay();
        }
        
        // Function to delete custom mutator
        function deleteCustomMutator(mutatorName) {
          // Remove from customMutators array
          customMutators = customMutators.filter(m => m.name !== mutatorName);
          
          // Save updated list to local storage
          localStorage.setItem('customMutators', JSON.stringify(customMutators));
          
          // Remove from selectedMutators if present
          const index = selectedMutators.indexOf(mutatorName);
          if (index !== -1) {
            selectedMutators.splice(index, 1);
          }
          
          // Regenerate mutator checkboxes
          generateMutatorCheckboxes();
        }
        
        // Initialize custom mutators form
        function initializeCustomMutators() {
          // First load any saved custom mutators
          loadCustomMutators();
          
          // Add the custom mutator input form
          const mutatorContainer = document.getElementById('mutatorCheckboxes');
          const customMutatorForm = document.createElement('div');
          customMutatorForm.className = 'custom-mutator-form';
          customMutatorForm.style.marginBottom = '20px';
          customMutatorForm.innerHTML = `
            <h3>Add Custom Mutator</h3>
            <div class="form-group" style="display: flex; gap: 10px;">
              <input type="text" id="customMutatorInput" placeholder="Enter custom mutator name" style="flex: 1;">
              <button type="button" class="btn btn-primary" onclick="addCustomMutator()">Add</button>
            </div>
          `;
          
          // Insert before the mutator checkboxes
          mutatorContainer.parentNode.insertBefore(customMutatorForm, mutatorContainer);
          
          // Generate mutator checkboxes (which will now include any loaded custom mutators)
          generateMutatorCheckboxes();
        }

        function updateMutatorCheckboxes() {
            const checkboxes = document.querySelectorAll('#mutatorCheckboxes input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectedMutators.includes(checkbox.value);
            });
        }

        function updateSelectedMutatorsDisplay() {
            const output = document.getElementById('selectedMutatorsOutput');
            if (selectedMutators.length === 0) {
                output.textContent = 'No mutators selected';
            } else {
                output.textContent = selectedMutators.join(', ');
            }
        }

        function searchMutators() {
            const searchTerm = document.getElementById('mutatorSearch').value.toLowerCase();
            const checkboxItems = document.querySelectorAll('#mutatorCheckboxes .checkbox-item');
            
            checkboxItems.forEach(item => {
                const label = item.querySelector('label').textContent.toLowerCase();
                const description = item.querySelector('.item-description').textContent.toLowerCase();
                
                if (label.includes(searchTerm) || description.includes(searchTerm)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
          // Initialize custom mutators
          initializeCustomMutators();
          
          // Continue with other initializations
          fetchMods();
          loadPresetsFromStorage();
        });
        
// This code integrates with your Google App Script backend
// to fetch popular mutator suggestions based on collected data

function createInfoModal() {
  if (document.getElementById('suggestionInfoModal')) return;
  
  const modalHTML = `
    <div id="suggestionInfoModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
      <div class="modal-content" style="background-color: white; margin: 15% auto; padding: 20px; border-radius: 5px; width: 80%; max-width: 600px; position: relative;">
        <span class="close" style="position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 24px;">&times;</span>
        <h2>Mod-Based Mutator Suggestions</h2>
        <p>Many Insurgency: Sandstorm mods require specific mutators to be enabled to work correctly.</p>
        <p>This feature will automatically suggest appropriate mutators based on the mods you select.</p>
        <p>When you select a mod that needs a special mutator, you'll see suggestions appear.</p>
        <div class="form-group" style="margin-top: 15px;">
          <label>
            <input type="checkbox" id="dontShowAgain"> Don't show this message again
          </label>
        </div>
        <button class="btn btn-primary" style="margin-top: 15px;" onclick="closeInfoModal()">Got it!</button>
      </div>
    </div>
  `;
  
  const modalContainer = document.createElement('div');
  modalContainer.innerHTML = modalHTML;
  document.body.appendChild(modalContainer.firstElementChild);
  
  // Add event listener for close button
  document.querySelector('#suggestionInfoModal .close').addEventListener('click', closeInfoModal);
}

// Fix 3: Improve the notification system
function createNotificationElement() {
  if (document.getElementById('notification')) return;
  
  const notificationElement = document.createElement('div');
  notificationElement.id = 'notification';
  notificationElement.className = 'notification';
  notificationElement.style.position = 'fixed';
  notificationElement.style.bottom = '20px';
  notificationElement.style.right = '20px';
  notificationElement.style.backgroundColor = '#4CAF50';
  notificationElement.style.color = 'white';
  notificationElement.style.padding = '15px 20px';
  notificationElement.style.borderRadius = '4px';
  notificationElement.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
  notificationElement.style.zIndex = '1000';
  notificationElement.style.transition = 'opacity 0.5s ease';
  notificationElement.style.opacity = '0';
  
  document.body.appendChild(notificationElement);
}

// Fix 4: Create the suggestions container properly
function createSuggestionsContainer() {
  if (document.getElementById('mutatorSuggestions')) return;
  
  const modsTab = document.getElementById('mods');
  if (!modsTab) return;
  
  const suggestionsContainer = document.createElement('div');
  suggestionsContainer.id = 'mutatorSuggestions';
  suggestionsContainer.className = 'mutator-suggestions';
  suggestionsContainer.style.marginTop = '20px';
  suggestionsContainer.style.padding = '15px';
  suggestionsContainer.style.backgroundColor = '#e3f2fd';
  suggestionsContainer.style.borderRadius = '4px';
  suggestionsContainer.style.display = 'none'; // Hide initially
  suggestionsContainer.style.borderLeft = '4px solid #2196F3';
  
  const suggestionsTitle = document.createElement('h3');
  suggestionsTitle.textContent = 'Suggested Mutators ';
  
  const refreshButton = document.createElement('button');
  refreshButton.id = 'refreshSuggestions';
  refreshButton.className = 'btn btn-secondary btn-sm';
  refreshButton.textContent = 'Refresh Suggestions';
  refreshButton.style.marginLeft = '10px';
  refreshButton.onclick = fetchMutatorSuggestionsFromGAS;
  
  suggestionsTitle.appendChild(refreshButton);
  suggestionsContainer.appendChild(suggestionsTitle);
  
  const suggestionsContent = document.createElement('div');
  suggestionsContent.id = 'suggestionsContent';
  suggestionsContainer.appendChild(suggestionsContent);
  
  // Find the best place to insert it
  const selectedModsOutput = document.getElementById('selectedModsOutput');
  if (selectedModsOutput && selectedModsOutput.parentNode) {
    selectedModsOutput.parentNode.insertBefore(suggestionsContainer, selectedModsOutput.nextSibling);
  } else {
    // Fallback - add to the end of the mods tab
    modsTab.appendChild(suggestionsContainer);
  }
}

// Fix 5: More reliable JSONP handling
function fetchMutatorSuggestionsFromGAS() {
  try {
    // Show loading state
    showNotification("Fetching mutator suggestions...", "info");
    
    // Your published GAS web app URL - replace with your actual URL
    const gasUrl = "https://script.google.com/macros/s/AKfycbxC5iMl7xgb4OmsGJD43XREDzAlsdKwchghdVCjhJpmewcU8ygBKEOa1VFt3VjmGaFm7Q/exec";
    
    // Generate a unique callback function name
    const callbackName = 'gasCallback_' + Math.floor(Math.random() * 1000000);
    
    // Build query params - include selected mods if any
    let queryParams = `?action=getSuggestions&callback=${callbackName}&t=${Date.now()}`;
    
    // Add selected mod IDs to query if available
    if (selectedMods && selectedMods.length > 0) {
      const modIds = selectedMods.map(mod => mod.id).join(',');
      queryParams += `&mods=${modIds}`;
    }
    
    // Create a script element for JSONP
    const script = document.createElement('script');
    script.src = gasUrl + queryParams;
    
    // Define the callback function
    window[callbackName] = function(data) {
      // Clean up
      if (script.parentNode) {
        document.head.removeChild(script);
      }
      
      delete window[callbackName];
      
      // Process the data
      console.log("Received suggestions from GAS:", data);
      
      if (data && data.success && data.suggestions) {
        // Update our suggestions database with new data
        Object.assign(modMutatorSuggestions, data.suggestions);
        
        // Update UI
        updateMutatorSuggestions();
        
        showNotification("Mutator suggestions updated!", "success");
      } else {
        console.log("No new suggestions returned from GAS. Using existing suggestions.");
        updateMutatorSuggestions();
      }
    };
    
    // Set a timeout to handle failed requests
    const timeoutId = setTimeout(() => {
      if (window[callbackName]) {
        // Clean up if callback wasn't called
        if (script.parentNode) {
          document.head.removeChild(script);
        }
        delete window[callbackName];
        
        console.log("GAS request timed out. Using existing suggestions.");
        updateMutatorSuggestions();
        showNotification("Using local suggestions data", "warning");
      }
    }, 8000);
    
    // Handle script loading errors
    script.onerror = function() {
      clearTimeout(timeoutId);
      if (script.parentNode) {
        document.head.removeChild(script);
      }
      delete window[callbackName];
      
      console.log("Error loading suggestions from GAS. Using existing suggestions.");
      updateMutatorSuggestions();
      showNotification("Using local suggestions data", "warning");
    };
    
    // Add the script to the document to start the request
    document.head.appendChild(script);
    
  } catch (error) {
    console.error("Error in fetchMutatorSuggestionsFromGAS:", error);
    showNotification("Error loading suggestions", "error");
    
    // Fallback to existing suggestions
    updateMutatorSuggestions();
  }
}

// Fix 6: Improved updateMutatorSuggestions function
function updateMutatorSuggestions() {
  const suggestionsContainer = document.getElementById('mutatorSuggestions');
  const suggestionsContent = document.getElementById('suggestionsContent');
  
  if (!suggestionsContainer || !suggestionsContent) {
    console.error("Suggestions container or content element not found");
    return;
  }
  
  // Clear previous suggestions
  suggestionsContent.innerHTML = '';
  
  // No selected mods
  if (!window.selectedMods || window.selectedMods.length === 0) {
    suggestionsContainer.style.display = 'none';
    return;
  }
  
  // Find suggestions based on selected mods
  const relevantSuggestions = [];
  
  selectedMods.forEach(mod => {
    // Convert mod.id to string to handle both numeric and string IDs
    const modId = String(mod.id);
    if (modMutatorSuggestions[modId]) {
      relevantSuggestions.push({
        mod: mod,
        suggestion: modMutatorSuggestions[modId]
      });
    }
  });
  
  // If no suggestions, hide the container
  if (relevantSuggestions.length === 0) {
    suggestionsContainer.style.display = 'none';
    return;
  }
  
  // Display suggestions
  suggestionsContainer.style.display = 'block';
  
  relevantSuggestions.forEach(item => {
    const suggestionBox = document.createElement('div');
    suggestionBox.className = 'suggestion-box';
    suggestionBox.style.marginBottom = '10px';
    suggestionBox.style.padding = '12px';
    suggestionBox.style.backgroundColor = '#fff';
    suggestionBox.style.borderRadius = '4px';
    suggestionBox.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
    
    const modName = document.createElement('div');
    modName.className = 'suggestion-mod-name';
    modName.style.fontWeight = 'bold';
    modName.style.marginBottom = '3px';
    modName.textContent = `For mod: ${item.mod.name}`;
    
    const mutatorName = document.createElement('div');
    mutatorName.className = 'suggestion-mutator-name';
    mutatorName.style.color = '#0d47a1';
    mutatorName.textContent = `Suggested mutator: ${item.suggestion.suggestedMutator}`;
    
    const description = document.createElement('div');
    description.className = 'suggestion-description';
    description.style.fontSize = '0.9em';
    description.style.color = '#666';
    description.style.marginTop = '5px';
    description.style.marginBottom = '10px';
    description.textContent = item.suggestion.description || 
                             `Used by ${Math.round((item.suggestion.popularity || 0) * 100)}% of players with this mod`;
    
    const applyButton = document.createElement('button');
    applyButton.className = 'btn btn-primary btn-sm';
    applyButton.style.padding = '5px 10px';
    applyButton.style.fontSize = '0.85em';
    applyButton.textContent = 'Apply This Mutator';
    applyButton.onclick = function() {
      applyMutatorSuggestion(item.suggestion.suggestedMutator);
    };
    
    suggestionBox.appendChild(modName);
    suggestionBox.appendChild(mutatorName);
    suggestionBox.appendChild(description);
    suggestionBox.appendChild(applyButton);
    
    suggestionsContent.appendChild(suggestionBox);
  });
  
  // Scroll to the suggestions if needed
  suggestionsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// Fix 7: Better notification function
function showNotification(message, type = "info") {
  createNotificationElement();
  
  const notification = document.getElementById('notification');
  if (!notification) return;
  
  // Clear any existing timeout
  if (window.notificationTimeout) {
    clearTimeout(window.notificationTimeout);
  }
  
  // Set the message
  notification.textContent = message;
  
  // Set the appropriate style based on type
  notification.className = "notification";
  
  // Set color based on type
  switch (type) {
    case "success":
      notification.style.backgroundColor = "#4CAF50";
      break;
    case "error":
      notification.style.backgroundColor = "#F44336";
      break;
    case "warning":
      notification.style.backgroundColor = "#FF9800";
      break;
    default:
      notification.style.backgroundColor = "#2196F3";
  }
  
  // Show the notification
  notification.style.opacity = '1';
  
  // Hide after 3 seconds
  window.notificationTimeout = setTimeout(() => {
    notification.style.opacity = '0';
  }, 3000);
}

// Fix 8: Modal display functions
function showSuggestionInfoModal() {
  createInfoModal();
  
  // Only show if user hasn't dismissed it before
  if (localStorage.getItem('suggestionInfoDismissed') !== 'true') {
    const modal = document.getElementById('suggestionInfoModal');
    if (modal) {
      modal.style.display = 'block';
    }
  }
}

function closeInfoModal() {
  const modal = document.getElementById('suggestionInfoModal');
  if (modal) {
    modal.style.display = 'none';
    
    // Check if "don't show again" is checked
    const dontShowAgain = document.getElementById('dontShowAgain');
    if (dontShowAgain && dontShowAgain.checked) {
      localStorage.setItem('suggestionInfoDismissed', 'true');
    }
  }
}

// Fix 9: Function to apply a suggested mutator
function applyMutatorSuggestion(mutatorName) {
  // First determine if this is a standard or custom mutator
  const isStandardMutator = mutators.some(m => m.name === mutatorName);
  
  if (isStandardMutator) {
    // If it's a standard mutator, select it in the list
    const mutatorCheckbox = document.getElementById(`mutator-${mutatorName}`);
    if (mutatorCheckbox) {
      mutatorCheckbox.checked = true;
      
      // Make sure it's in the selectedMutators array
      if (!selectedMutators.includes(mutatorName)) {
        selectedMutators.push(mutatorName);
      }
      
      // Update display
      updateSelectedMutatorsDisplay();
      
      // Feedback to user
      showNotification(`Applied mutator: ${mutatorName}`, "success");
      
      // Switch to mutators tab
      openTab({ currentTarget: document.querySelector('.tab[onclick*="mutators"]') }, 'mutators');
      
      // Highlight the selected mutator
      mutatorCheckbox.parentNode.style.backgroundColor = '#e3f2fd';
      setTimeout(() => {
        mutatorCheckbox.parentNode.style.backgroundColor = '';
      }, 2000);
    } else {
      console.error(`Mutator checkbox for ${mutatorName} not found`);
      showNotification(`Could not find mutator: ${mutatorName}`, "error");
    }
  } else {
    // It's a custom mutator
    if (!selectedMutators.includes(mutatorName)) {
      // Check if already in custom mutators
      const existingCustomMutator = customMutators.find(m => m.name === mutatorName);
      
      if (!existingCustomMutator) {
        // Add to custom mutators
        const newMutator = { 
          name: mutatorName, 
          description: 'Added from mod suggestion', 
          isCustom: true 
        };
        customMutators.push(newMutator);
        
        // Save to local storage
        localStorage.setItem('customMutators', JSON.stringify(customMutators));
      }
      
      // Add to selected mutators
      selectedMutators.push(mutatorName);
      
      // Regenerate mutator checkboxes
      if (typeof generateMutatorCheckboxes === 'function') {
        generateMutatorCheckboxes();
      }
      
      // Switch to mutators tab
      openTab({ currentTarget: document.querySelector('.tab[onclick*="mutators"]') }, 'mutators');
      
      // Highlight the newly added mutator
      setTimeout(() => {
        const mutatorCheckbox = document.getElementById(`mutator-custom-${mutatorName}`);
        if (mutatorCheckbox) {
          mutatorCheckbox.parentNode.style.backgroundColor = '#e3f2fd';
          setTimeout(() => {
            mutatorCheckbox.parentNode.style.backgroundColor = '';
          }, 2000);
        }
      }, 100);
      
      showNotification(`Added custom mutator: ${mutatorName}`, "success");
    } else {
      showNotification(`Mutator ${mutatorName} already selected`, "info");
    }
  }
  
  // Log this selection
  logMutatorSelection(mutatorName);
}

// Fix 10: Initialize everything properly
function initMutatorSuggestions() {
  // Create UI elements
  createNotificationElement();
  createInfoModal();
  createSuggestionsContainer();
  
  // Hook into mod selection changes
  // We need to extend the existing updateSelectedModsDisplay function
  if (window.updateSelectedModsDisplay) {
    const originalUpdateSelectedModsDisplay = window.updateSelectedModsDisplay;
    window.updateSelectedModsDisplay = function() {
      // Call original function
      originalUpdateSelectedModsDisplay.apply(this, arguments);
      
      // Then update mutator suggestions
      updateMutatorSuggestions();
      
      // If mods are selected and we haven't already fetched suggestions in this session
      if (selectedMods && selectedMods.length > 0 && !window.hasFetchedSuggestions) {
        fetchMutatorSuggestionsFromGAS();
        window.hasFetchedSuggestions = true;
      }
    };
  }
  
  // Add a global function for other scripts to access
  window.showSuggestionModal = showSuggestionInfoModal;
  window.closeSuggestionModal = closeInfoModal;
  
  // Show info modal after a short delay
  setTimeout(showSuggestionInfoModal, 1000);
  
  // Update suggestions initially with the built-in data
  updateMutatorSuggestions();
}

// Fix 11: Start everything when the DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initMutatorSuggestions);
} else {
  // DOM is already ready
  initMutatorSuggestions();
}

// 4. Function to log when a user applies a suggested mutator
function logMutatorSelection(mutatorName) {
  if (!selectedMods || selectedMods.length === 0) return;
  
  // Basic input validation
  if (!mutatorName || typeof mutatorName !== 'string' || mutatorName.length > 100) return;
  
  // Prepare data to send - limit what we collect
  const data = {
    timestamp: new Date().toISOString(),
    mutator: mutatorName,
    source: 'suggestion', // Indicate this was from a suggestion
    mods: selectedMods.map(mod => ({
      id: mod.id,
      name: mod.name.substring(0, 100) // Limit name length
    })).slice(0, 20) // Limit number of mods
  };
  
  // Add a nonce to prevent replay attacks
  const nonce = Math.random().toString(36).substring(2, 15);
  data.nonce = nonce;
  
  // Send data to GAS Web App
  fetch('https://script.google.com/macros/s/AKfycbxC5iMl7xgb4OmsGJD43XREDzAlsdKwchghdVCjhJpmewcU8ygBKEOa1VFt3VjmGaFm7Q/exec', {
    method: 'POST',
    mode: 'no-cors', // Important for GAS web apps
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  }).catch(error => {
    console.error('Error logging mutator selection:', error);
    // Silently fail - don't interrupt user experience
  });
}






        

        
        // Mutators data
        const mutators = [
            { name: 'AllYouCanEat', description: 'Start with 100 supply points.' },
            { name: 'AntiMaterielRiflesOnly', description: 'Only anti-materiel rifles are available along with normal equipment and explosives.' },
            { name: 'BoltActionsOnly', description: 'Only bolt-action rifles are available along with normal equipment and explosives.' },
            { name: 'Broke', description: 'Start with 0 supply points.' },
            { name: 'BudgetAntiquing', description: 'Normal equipment and explosives, but limited to old and inexpensive weapons.' },
            { name: 'BulletSponge', description: 'Health is increased.' },
            { name: 'Competitive', description: 'Equipment is more expensive, rounds are shorter, and capturing objectives is faster.' },
            { name: 'CompetitiveLoadouts', description: 'Player classes are replaced with those from Competitive.' },
            { name: 'FastMovement', description: 'Move Faster.' },
            { name: 'Frenzy', description: 'Fight against AI enemies who only use melee attacks. Watch out for special enemies.' },
            { name: 'FullyLoaded', description: 'All weapons, equipment, and explosives in the game are available in the Loadout Menu' },
            { name: 'Guerrillas', description: 'Start with 5 supply points.' },
            { name: 'Gunslingers', description: 'Kill the enemy more than they kill you with a big stinkin revolver. And explosives.' },
            { name: 'Hardcore', description: 'Mutator featuring slower movement speeds and longer capture times.' },
            { name: 'HeadshotOnly', description: 'Players only take damage when shot in the head.' },
            { name: 'HotPotato', description: 'A live fragmentation grenade is dropped on death.' },
            { name: 'LockedAim', description: 'Weapons always point to the center of the screen.' },
            { name: 'MakarovsOnly', description: 'Makarovs are the only option.' },
            { name: 'NoAim', description: 'Aiming down sights is disabled.' },
            { name: 'NoDrops', description: 'No scavenging allowed.' },
            { name: 'PistolsOnly', description: 'Only pistols are available along with normal equipment and explosives.' },
            { name: 'Poor', description: 'Start with limited supply.' },
            { name: 'ShotgunsOnly', description: 'Only Shotguns are available along with normal equipment and explosives.' },
            { name: 'SlowCaptureTimes', description: 'Objectives will take longer to capture.' },
            { name: 'SlowMovement', description: 'Move slower.' },
            { name: 'SoldierOfFortune', description: 'Gain supply points as your score increases.' },
            { name: 'SpecialOperations', description: 'Start with 30 supply points.' },
            { name: 'Strapped', description: 'Start with 1 supply point.' },
            { name: 'Ultralethal', description: 'Everyone dies with one shot.' },
            { name: 'Vampirism', description: 'Receive health when dealing damage to enemies equal to the amount of damage dealt.' },
            { name: 'Warlords', description: 'Start with 10 supply points.' }
        ];
        
        function logCustomMutatorToGAS(mutatorName) {
          // Only send if user has mods selected
          if (!selectedMods || selectedMods.length === 0) return;
          
          // Basic input validation
          if (!mutatorName || typeof mutatorName !== 'string' || mutatorName.length > 100) return;
          
          // Prepare data to send - limit what we collect
          const data = {
            timestamp: new Date().toISOString(),
            mutator: mutatorName,
            mods: selectedMods.map(mod => ({
              id: mod.id,
              name: mod.name.substring(0, 100) // Limit name length
            })).slice(0, 20) // Limit number of mods to prevent abuse
          };
          
          // Add a random delay to prevent timing attacks (50-200ms)
          const randomDelay = 50 + Math.floor(Math.random() * 150);
          setTimeout(() => {
            // Add a nonce to prevent replay attacks
            const nonce = Math.random().toString(36).substring(2, 15);
            data.nonce = nonce;
            
            // Rate limiting - check if we've sent too many requests recently
            const recentRequests = localStorage.getItem('recentGASRequests') || '[]';
            let requests = JSON.parse(recentRequests);
            const now = Date.now();
            
            // Keep only requests from the last minute
            requests = requests.filter(time => now - time < 60000);
            
            // If we've made more than 5 requests in the last minute, don't send another
            if (requests.length >= 5) {
              console.log('Rate limited: Too many requests to GAS');
              return;
            }
            
            // Add this request time
            requests.push(now);
            localStorage.setItem('recentGASRequests', JSON.stringify(requests));
            
            // Send data to GAS Web App (replace with your actual GAS URL)
            fetch('https://script.google.com/macros/s/AKfycbxC5iMl7xgb4OmsGJD43XREDzAlsdKwchghdVCjhJpmewcU8ygBKEOa1VFt3VjmGaFm7Q/exec', {
              method: 'POST',
              mode: 'no-cors', // Important for GAS web apps
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            }).catch(error => {
              console.error('Error logging custom mutator:', error);
              // Silently fail - don't interrupt user experience
            });
          }, randomDelay);
        }

        // Tab switching
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tab");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Server configuration functions
        function generateConfig() {
            const os = document.getElementById('os').value;
            const hostname = document.getElementById('hostname').value;
            const maxPlayers = document.getElementById('maxPlayers').value;
            const port = document.getElementById('port').value;
            const queryPort = document.getElementById('queryPort').value;
            const scenario = document.getElementById('scenario').value;
            const password = document.getElementById('password').value;
            const enableCheats = document.getElementById('enableCheats').checked;
            const gameStatsToken = document.getElementById('gameStatsToken').value;
            const gsltToken = document.getElementById('gsltToken').value;
            const enableGameStats = document.getElementById('enableGameStats').checked;
            const officialRules = document.getElementById('officialRules').checked;

            let configString = "";
            const baseCommand = os === "windows" ?
                "InsurgencyServer.exe" :
                "Insurgency/Binaries/Linux/InsurgencyServer-Linux-Shipping";

            let travelParams = `${scenario}?MaxPlayers=${maxPlayers}`;

            if (password) travelParams += `?Password=${password}`;

            let gsltTokenParam = gsltToken ? ` -GSLTToken=${gsltToken}` : "";
            let cheatParam = enableCheats ? " -EnableCheats" : "";
            let gameStatsParam = (gameStatsToken && enableGameStats) ? ` -GameStatsToken=${gameStatsToken} -GameStats` : "";
            let officialRulesParam = officialRules ? " -ruleset=OfficialRules" : "";
            
            // Add mutators parameter
            let mutatorParam = selectedMutators.length > 0 ? ` -Mutators=${selectedMutators.join(',')}` : "";
            
            // Add mods parameter
            let modsParam = "";
            if (selectedMods.length > 0) {
                const modIds = selectedMods.map(mod => mod.id).join(',');
                modsParam = ` -mods -CmdModList=${modIds}`;
            }

            configString = `${baseCommand} ${travelParams} -Port=${port} -QueryPort=${queryPort} -log -hostname="${hostname}"${cheatParam}${gameStatsParam}${gsltTokenParam}${officialRulesParam}${mutatorParam}${modsParam}`;

            document.getElementById('configOutput').value = configString;
        }

        function launchServer() {
            generateConfig();
            
            const scenario = document.getElementById('scenario').value;
            const maxPlayers = document.getElementById('maxPlayers').value;
            const port = document.getElementById('port').value;
            const queryPort = document.getElementById('queryPort').value;
            const hostname = document.getElementById('hostname').value;
            const password = document.getElementById('password').value;
            const enableCheats = document.getElementById('enableCheats').checked;
            const gameStatsToken = document.getElementById('gameStatsToken').value;
            const gsltToken = document.getElementById('gsltToken').value;
            const enableGameStats = document.getElementById('enableGameStats').checked;
            const officialRules = document.getElementById('officialRules').checked;

            let serverParams = `${scenario}?MaxPlayers=${maxPlayers} -Port=${port} -QueryPort=${queryPort} -log -hostname="${hostname}"`;

            if (password) serverParams += `?Password=${password}`;
            if (enableCheats) serverParams += ' -EnableCheats';
            if (gameStatsToken && enableGameStats) serverParams += ` -GameStatsToken=${gameStatsToken} -GameStats`;
            if (gsltToken) serverParams += ` -GSLTToken=${gsltToken}`;
            if (officialRules) serverParams += ' -ruleset=OfficialRules';
            
            // Add mutators parameter
            if (selectedMutators.length > 0) {
                serverParams += ` -Mutators=${selectedMutators.join(',')}`;
            }
            
            // Add mods parameter
            if (selectedMods.length > 0) {
                const modIds = selectedMods.map(mod => mod.id).join(',');
                serverParams += ` -mods -CmdModList=${modIds}`;
            }

            const steamURL = `steam://rungameid/581330//${encodeURIComponent(serverParams)}`;
            window.location.href = steamURL;
        }

        function quickStart() {
            document.getElementById('hostname').value = 'My Insurgency Server';
            document.getElementById('maxPlayers').value = '24';
            document.getElementById('port').value = '27102';
            document.getElementById('queryPort').value = '27131';
            
            const scenarioDropdown = document.getElementById('scenario');
            const randomIndex = Math.floor(Math.random() * scenarioDropdown.options.length);
            scenarioDropdown.selectedIndex = randomIndex;
            
            launchServer();
        }

        // Preset functions
        function savePreset() {
            const presetName = prompt('Enter a name for the preset:');
            if (!presetName) return;
            
            const preset = {
                name: presetName,
                os: document.getElementById('os').value,
                hostname: document.getElementById('hostname').value,
                maxPlayers: document.getElementById('maxPlayers').value,
                port: document.getElementById('port').value,
                queryPort: document.getElementById('queryPort').value,
                scenario: document.getElementById('scenario').value,
                password: document.getElementById('password').value,
                enableCheats: document.getElementById('enableCheats').checked,
                gameStatsToken: document.getElementById('gameStatsToken').value,
                gsltToken: document.getElementById('gsltToken').value,
                enableGameStats: document.getElementById('enableGameStats').checked,
                officialRules: document.getElementById('officialRules').checked,
                selectedMutators: [...selectedMutators],
                selectedMods: [...selectedMods]
            };
            
            let presets = JSON.parse(localStorage.getItem('presets') || '[]');
            presets.push(preset);
            localStorage.setItem('presets', JSON.stringify(presets));
            renderPresetButtons(presets);
        }

        function loadPresetsFromStorage() {
            const presets = JSON.parse(localStorage.getItem('presets') || '[]');
            renderPresetButtons(presets);
        }

        function renderPresetButtons(presets) {
            const presetButtonsContainer = document.getElementById('presetButtons');
            presetButtonsContainer.innerHTML = '';
            
            presets.forEach((preset, index) => {
                const presetDiv = document.createElement('div');
                presetDiv.className = 'preset';

                const presetNameSpan = document.createElement('span');
                presetNameSpan.textContent = preset.name;

                const launchButton = document.createElement('button');
                launchButton.textContent = 'Launch';
                launchButton.className = 'btn btn-primary';
                launchButton.onclick = function() {
                    loadPreset(index);
                    launchServer();
                };

                const renameButton = document.createElement('button');
                renameButton.textContent = 'Rename';
                renameButton.className = 'btn btn-secondary';
                renameButton.onclick = function() {
                    renamePreset(index);
                };

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.className = 'btn btn-danger';
                deleteButton.onclick = function() {
                    deletePreset(index);
                };

                presetDiv.appendChild(presetNameSpan);
                presetDiv.appendChild(launchButton);
                presetDiv.appendChild(renameButton);
                presetDiv.appendChild(deleteButton);

                presetButtonsContainer.appendChild(presetDiv);
            });
        }

        function deletePreset(index) {
            const presets = JSON.parse(localStorage.getItem('presets') || '[]');
            presets.splice(index, 1);
            localStorage.setItem('presets', JSON.stringify(presets));
            renderPresetButtons(presets);
        }

        function renamePreset(index) {
            const presets = JSON.parse(localStorage.getItem('presets') || '[]');
            const newName = prompt('Enter a new name for the preset:', presets[index].name);
            if (newName) {
                presets[index].name = newName;
                localStorage.setItem('presets', JSON.stringify(presets));
                renderPresetButtons(presets);
            }
        }

        function loadPreset(index) {
            const presets = JSON.parse(localStorage.getItem('presets') || '[]');
            const preset = presets[index];
            if (!preset) return;
            
            document.getElementById('os').value = preset.os;
            document.getElementById('hostname').value = preset.hostname;
            document.getElementById('maxPlayers').value = preset.maxPlayers;
            document.getElementById('port').value = preset.port;
            document.getElementById('queryPort').value = preset.queryPort;
            document.getElementById('scenario').value = preset.scenario;
            document.getElementById('password').value = preset.password;
            document.getElementById('enableCheats').checked = preset.enableCheats;
            document.getElementById('gameStatsToken').value = preset.gameStatsToken;
            document.getElementById('gsltToken').value = preset.gsltToken;
            document.getElementById('enableGameStats').checked = preset.enableGameStats;
            document.getElementById('officialRules').checked = preset.officialRules;
            
            // Load saved mutators and mods
            selectedMutators = preset.selectedMutators || [];
            selectedMods = preset.selectedMods || [];
            
            updateMutatorCheckboxes();
            updateModCheckboxes();
            updateSelectedMutatorsDisplay();
            updateSelectedModsDisplay();
        }

        function exportPresets() {
            const presets = JSON.parse(localStorage.getItem('presets') || '[]');
            const presetsJSON = JSON.stringify(presets, null, 2);
            const blob = new Blob([presetsJSON], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'insurgency_server_presets.json';
            link.click();
        }

        function importPresets() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'application/json';
            fileInput.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const presetsJSON = e.target.result;
                        const presets = JSON.parse(presetsJSON);
                        localStorage.setItem('presets', JSON.stringify(presets));
                        renderPresetButtons(presets);
                        alert('Presets imported successfully!');
                    } catch (error) {
                        alert('Error importing presets: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            fileInput.click();
        }




        // Mod functions
        async function fetchMods() {
            try {
                // Add timestamp as query parameter to prevent caching
                const timestamp = new Date().getTime();
                const response = await fetch(`https://extremelystiff.github.io/ISSS/mods.json?t=${timestamp}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                mods = await response.json();
                generateModCheckboxes();
                console.log('Fetched mods:', mods);
            } catch (error) {
                console.error('Error fetching mods:', error);
                alert('Failed to fetch mods. Please try again later.');
                
                // Fallback to some example mods for testing
                mods = [
                    { id: 81844, name: "Example Content", summary: "Example Content from mod kit." },
                    { id: 89591, name: "Shoot House", summary: "Shoot House" },
                    { id: 91912, name: "Wolf-land (Nightfall 1.7 Update)", summary: "Update 0.6 - Added Night Lighting Scenario, temporarily disabled Checkpoint, various cover tweaks" },
                    { id: 92807, name: "M45A1 Wolfpack", summary: "Black variant of the M45A1" }
                ];
                generateModCheckboxes();
            }
        }

        function generateModCheckboxes() {
          const modCheckboxesContainer = document.getElementById('modCheckboxes');
          modCheckboxesContainer.innerHTML = '';
          
          if (!mods || mods.length === 0) {
            modCheckboxesContainer.innerHTML = '<p>No mods available. Please try refreshing the mod list.</p>';
            return;
          }
          
          mods.forEach(mod => {
            const checkboxItem = document.createElement('div');
            checkboxItem.className = 'checkbox-item';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = mod.id;
            checkbox.id = `mod-${mod.id}`;
            checkbox.checked = selectedMods.some(selectedMod => selectedMod.id === mod.id);
            checkbox.addEventListener('change', function() {
              if (this.checked) {
                if (!selectedMods.some(selectedMod => selectedMod.id === mod.id)) {
                  selectedMods.push(mod);
                  // Check if there are any custom mutators selected, and log them
                  logSelectedCustomMutators();
                }
              } else {
                selectedMods = selectedMods.filter(selectedMod => selectedMod.id !== mod.id);
              }
              updateSelectedModsDisplay();
            });
            
            const label = document.createElement('label');
            label.htmlFor = checkbox.id;
            label.textContent = mod.name;
            
            const description = document.createElement('div');
            description.className = 'item-description';
            description.textContent = mod.summary || 'No description available';
            
            checkboxItem.appendChild(checkbox);
            checkboxItem.appendChild(label);
            checkboxItem.appendChild(description);
            
            modCheckboxesContainer.appendChild(checkboxItem);
          });
          
          updateSelectedModsDisplay();
        }

        function updateModCheckboxes() {
            const checkboxes = document.querySelectorAll('#modCheckboxes input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                const modId = parseInt(checkbox.value);
                checkbox.checked = selectedMods.some(mod => mod.id === modId);
            });
        }

        function updateSelectedModsDisplay() {
            const output = document.getElementById('selectedModsOutput');
            if (selectedMods.length === 0) {
                output.textContent = 'No mods selected';
            } else {
                let modInfo = selectedMods.map(mod => `${mod.name} (ID: ${mod.id})`).join('\n');
                output.textContent = modInfo;
            }
        }

        function searchMods() {
            const searchTerm = document.getElementById('modSearch').value.toLowerCase();
            const checkboxItems = document.querySelectorAll('#modCheckboxes .checkbox-item');
            
            checkboxItems.forEach(item => {
                const label = item.querySelector('label').textContent.toLowerCase();
                const description = item.querySelector('.item-description').textContent.toLowerCase();
                
                if (label.includes(searchTerm) || description.includes(searchTerm)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // GameStats token auto-check enableGameStats
        document.getElementById('gameStatsToken').addEventListener('input', function(e) {
            document.getElementById('enableGameStats').checked = !!e.target.value.trim();
        });
    </script>
</body>
</html>
